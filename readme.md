

# Nexus Backend

This directory contains the FastAPI backend service for the Nexus Copilot application. It is responsible for handling all complex, long-running, and data-intensive operations, providing a robust API for the Tauri frontend.

## Core Features

-   **ğŸ¤– Agentic Framework:** Orchestrates and executes multi-step AI agent tasks using different modes (Plan, Explore, Write, Research, Debate).
-   **ğŸ”„ LLM & API Proxy:** Provides a unified interface for communicating with various external LLM and creative AI APIs (for chat, embeddings, image/audio/video generation), injecting RAG context in the process.
-   **ğŸ§  Vector Database Service:** Manages a persistent instance of [ChromaDB](https://www.trychroma.com/) for efficient similarity search and Retrieval-Augmented Generation (RAG).
-   **ğŸ“š Knowledge Base Management:** Handles document parsing (PDF, DOCX, etc.), text chunking, embedding generation, and indexing.
-   **ğŸ•¸ï¸ Knowledge Graph:** Parses `[[WikiLinks]]` in Markdown notes to build and maintain a knowledge graph of interconnected ideas.
-   **ğŸ“Š Data & System Services:** Provides API endpoints for application dashboard statistics, full data backup/restore, and batch document conversion.
-   **ğŸ¨ Creative Content Generation:** Proxies requests to external services to generate creative content like images, audio, and video.

## Technology Stack

-   **Web Framework:** [FastAPI](https://fastapi.tiangolo.com/)
-   **ASGI Server:** [Uvicorn](https://www.uvicorn.org/)
-   **Vector Storage:** [ChromaDB](https://www.trychroma.com/)
-   **Structured Data Storage:** [SQLite](https://www.sqlite.org/index.html)
-   **Text Processing:** [LangChain](https://www.langchain.com/) (for text splitting)
-   **Data Validation:** [Pydantic](https://docs.pydantic.dev/)

## Project Structure

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/              # FastAPI routes and endpoint definitions
â”‚   â”œâ”€â”€ agents/           # Core logic for the Agentic Framework, including modes and prompts
â”‚   â”œâ”€â”€ core/             # Application configuration (e.g., data paths)
â”‚   â”œâ”€â”€ database/         # SQLite database connection and initialization
â”‚   â”œâ”€â”€ knowledge_base/   # Logic related to document indexing and search
â”‚   â”œâ”€â”€ schemas/          # Pydantic models for API request/response validation
â”‚   â””â”€â”€ services/         # Core business logic (interacting with DB, external APIs, etc.)
â”œâ”€â”€ files/                # (Created at runtime) Stores logs and reports generated by Agents
â”œâ”€â”€ tasks/                # (Created at runtime) Stores previewable files generated by Agents (e.g., HTML)
â”œâ”€â”€ chroma_data/          # (Created at runtime) Persistent data for ChromaDB
â”œâ”€â”€ nexus.sqlite          # (Created at runtime) The SQLite database file
â””â”€â”€ main.py               # Main entry point for the FastAPI application
```

## Installation & Running

This backend service is designed to be automatically managed (installed, started, and stopped) by the main Nexus Tauri application. However, for standalone development and testing, you can run it manually by following these steps:

1.  **Prerequisites:**
    -   Python 3.10 or higher
    -   Git

2.  **Clone Dependencies (if not already done):**
    The backend relies on a Git submodule for its core dependencies. Ensure it has been cloned:
    ```bash
    git submodule update --init --recursive
    ```

3.  **Create a Virtual Environment:**
    ```bash
    python -m venv venv
    ```

4.  **Activate the Virtual Environment:**
    -   On macOS/Linux: `source venv/bin/activate`
    -   On Windows: `venv\Scripts\activate`

5.  **Install Dependencies:**
    The backend requires dependencies to be installed from the `requirements.txt` file.
    ```bash
    pip install -r requirements.txt
    ```

6.  **Run the Development Server:**
    ```bash
    uvicorn app.main:app --reload --port 8008
    ```
    The server should now be running at `http://127.0.0.1:8008`.

### Configuration Notes

The backend receives all necessary configurations (like API keys) from the Tauri frontend via the `ApiConfig` schema. It is designed to be stateless and does not store sensitive keys directly.

The `NEXUS_DATA_PATH` environment variable is set by the Tauri application at startup. In standalone development mode, this path defaults to the `backend/` directory itself. All persistent data (SQLite DB, ChromaDB data, Agent files) will be stored within this directory.

## API Overview

All endpoints are prefixed with `/api/v1`.

-   `/agent`: Start, stop, resume, and get the status of Agent tasks.
-   `/proxy`: Securely proxies requests to external LLM APIs, handling RAG context injection and authentication.
-   `/vector`: Interacts with the ChromaDB vector store (add, query, delete vectors).
-   `/knowledge_base`: Processes files for indexing and manages knowledge graph links.
-   `/creations`: Generates creative content like images and audio.
-   `/dashboard`: Provides statistical data for the dashboard UI.
-   `/backup`: Handles full export and import of application data.
-   `/convert`: Provides a streaming endpoint for batch document conversion.

## Workflow Example: Lifecycle of an Agent Task

1.  The Tauri frontend sends a request to `/api/v1/agent/start-task` with the user's goal and the current `ApiConfig`.
2.  The backend creates a new task record in SQLite and starts a background job using `BackgroundTasks`.
3.  `agents.runner` takes over the task and delegates to the appropriate executor based on the requested `mode` (e.g., `write_mode`).
4.  The agent mode orchestrates calls to LLMs via the `/proxy` endpoint to generate plans, strategies, and content.
5.  Intermediate results and the final report are saved to the SQLite database and the filesystem (under the `files/` directory).
6.  The Tauri frontend polls the `/api/v1/agent/get-task-status/{task_id}` endpoint to get real-time updates and display them to the user.